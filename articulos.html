<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestión de Artículos</title>

    <!-- Import Firebase SDK (v8 with namespaced API) -->
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
    
    <!-- Import Firebase configuration -->
    <script src="https://facturacionweb.github.io/facturacionweb/firebase-config.js"></script>
    
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
        }
        .container {
            max-width: 1000px;
            margin: 0 auto;
        }
        input, button, label, select {
            margin: 10px 0;
            display: block;
            width: 100%;
            padding: 10px;
        }
        table {
            width: 100%;
            border-collapse: collapse;
        }
        table, th, td {
            border: 1px solid black;
            padding: 10px;
            text-align: left;
        }
        th, td {
            text-align: center;
        }
    </style>
    <script>
        (function loadVersionScript() {
            const versionScript = document.createElement('script');
            versionScript.src = 'https://facturacionweb.github.io/facturacionweb/version.js?v=' + new Date().getTime();
            document.head.appendChild(versionScript);
        })();
    </script>
</head>
<body>
    <script>
        window.onload = function() {
            const isAuthenticated = sessionStorage.getItem('isAuthenticated');
            if (!isAuthenticated) {
                alert("Debe autenticarse primero");
                window.location.href = "index.html";
            } else {
                loadArticulos();
                loadProveedoresToDropdown();
            }
        };
    </script>

    <a href="index.html">Volver a la Página Principal</a>
    
    <div class="container">
        <h1>Gestión de Artículos</h1>

        <!-- Formulario para agregar o editar un artículo -->
        <input type="text" id="codigoArticulo" placeholder="Código del Artículo" />
        <select id="rubro">
            <option value="">Seleccione un Rubro</option>
            <option value="teléfonos">Teléfonos</option>
            <option value="tablet">Tablet</option>
            <option value="otros">Otros</option>
        </select>
        <input type="text" id="marca" placeholder="Marca" />
        <input type="text" id="modelo" placeholder="Modelo" />
        <textarea id="descripcion" placeholder="Descripción"></textarea>
        <input type="text" id="imei1" placeholder="IMEI 1" />
        <input type="text" id="imei2" placeholder="IMEI 2" />
        <select id="proveedor">
            <option value="">Seleccione un Proveedor</option>
            <!-- Opciones cargadas dinámicamente -->
        </select>
        <input type="text" id="facturaProveedor" placeholder="Factura del Proveedor" />
        <input type="datetime-local" id="fechaEntrada" />
        <input type="text" id="semana" placeholder="Semana" />
        <select id="ubicacion">
            <option value="">Seleccione Ubicación</option>
            <option value="Ruta 1">Ruta 1</option>
            <option value="Ruta 2">Ruta 2</option>
            <option value="Bodega General">Bodega General</option>
            <option value="En Taller">En Taller</option>
        </select>
        <input type="text" id="facturaCliente" placeholder="Factura del Cliente" />
        <input type="number" id="precioCompra" placeholder="Precio de Compra" />
        <input type="number" id="precioVenta" placeholder="Precio de Venta" />
        <input type="number" id="precioVentaReal" placeholder="Precio de Venta Real" />
        <input type="number" id="descuento" placeholder="Descuento" readonly />
        <label>
            <input type="checkbox" id="activo" /> Activo
        </label>
        <input type="number" id="existencias" placeholder="Existencias" />

        <button onclick="addOrUpdateArticulo()">Agregar/Actualizar Artículo</button>
        <button onclick="clearFields()">Limpiar Campos</button>

        <!-- Tabla para mostrar los artículos existentes -->
        <h2>Artículos Existentes</h2>
        <table>
            <thead>
                <tr>
                    <th>Código</th>
                    <th>Descripción</th>
                    <th>Marca</th>
                    <th>Modelo</th>
                    <th>Ubicación</th>
                    <th>Precio Venta</th>
                    <th>Existencias</th>
                    <th>Acciones</th>
                </tr>
            </thead>
            <tbody id="articuloTable">
                <!-- Filas de artículos se cargarán dinámicamente -->
            </tbody>
        </table>
    </div>

    <script>
        const db = firebase.firestore();

        function clearFields() {
            document.getElementById('codigoArticulo').value = '';
            document.getElementById('rubro').value = '';
            // Limpiar todos los demás campos...
        }

        function addOrUpdateArticulo() {
            const codigoArticulo = document.getElementById('codigoArticulo').value.trim();
            const rubro = document.getElementById('rubro').value;
            const marca = document.getElementById('marca').value.trim();
            // Obtener y validar todos los demás campos...

            if (codigoArticulo) {
                db.collection("articulos").doc(codigoArticulo).set({
                    codigoArticulo: codigoArticulo,
                    rubro: rubro,
                    marca: marca,
                    // Guardar los demás campos...
                }).then(() => {
                    alert("Artículo agregado o actualizado con éxito");
                    loadArticulos();
                }).catch((error) => {
                    console.error("Error al agregar o actualizar el artículo: ", error);
                });
            } else {
                alert("El código del artículo es requerido");
            }
        }

        function loadArticulos() {
            db.collection("articulos").get().then((querySnapshot) => {
                const articuloTable = document.getElementById('articuloTable');
                articuloTable.innerHTML = '';
                querySnapshot.forEach((doc) => {
                    const articulo = doc.data();
                    const row = `<tr>
                                    <td>${articulo.codigoArticulo}</td>
                                    <td>${articulo.descripcion}</td>
                                    <td>${articulo.marca}</td>
                                    <td>${articulo.modelo}</td>
                                    <td>${articulo.ubicacion}</td>
                                    <td>${articulo.precioVenta}</td>
                                    <td>${articulo.existencias}</td>
                                    <td>
                                        <button onclick="editArticulo('${doc.id}')">Editar</button>
                                        <button onclick="deleteArticulo('${doc.id}')">Eliminar</button>
                                    </td>
                                </tr>`;
                    articuloTable.innerHTML += row;
                });
            }).catch((error) => {
                console.error("Error al cargar los artículos: ", error);
            });
        }

        function loadProveedoresToDropdown() {
            const proveedorDropdown = document.getElementById('proveedor');
            db.collection("proveedores").get().then((querySnapshot) => {
                querySnapshot.forEach((doc) => {
                    const proveedor = doc.data();
                    const option = `<option value="${doc.id}">${proveedor.nombreProveedor}</option>`;
                    proveedorDropdown.innerHTML += option;
                });
            }).catch((error) => {
                console.error("Error al cargar los proveedores: ", error);
            });
        }
    </script>
</body>
</html>

