<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Gestión de Artículos y Existencias (IMEI) 😎</title>

  <!-- Import Firebase SDK (v8 with namespaced API) -->
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
  <!-- Firebase Config -->
  <script src="https://facturacionweb.github.io/facturacionweb/firebase-config.js"></script>
  
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
    }
    .container {
      max-width: 1000px;
      margin: 0 auto;
      margin-bottom: 40px;
    }
    input[type="text"],
    input[type="number"],
    button,
    select {
      margin: 10px 0;
      display: block;
      width: 100%;
      padding: 10px;
      box-sizing: border-box;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
    }
    table, th, td {
      border: 1px solid #ccc;
    }
    th, td {
      padding: 8px;
      text-align: left;
    }
    h1, h2 {
      text-align: center;
    }
  </style>

  <script>
    // Script para cargar versión (opcional)
    (function loadVersionScript() {
      const versionScript = document.createElement('script');
      versionScript.src = 'https://facturacionweb.github.io/facturacionweb/version.js?v=' + new Date().getTime();
      document.head.appendChild(versionScript);
    })();
  </script>
</head>
<body>
  <h1>Gestión de Artículos y Existencias (IMEI) 📱💾</h1>

  <!-- Sección de Artículos -->
  <div class="container" id="articlesSection">
    <h2>Gestión de Artículos</h2>
    <!-- Formulario para Artículos -->
    <input type="text" id="articleId" placeholder="ID del Artículo" />
    <input type="text" id="marca" placeholder="Marca" />
    <input type="text" id="modelo" placeholder="Modelo" />
    <input type="number" id="precioCompra" placeholder="Precio de Compra" step="0.01" />
    <input type="number" id="precioVenta" placeholder="Precio de Venta" step="0.01" />
    <button onclick="addOrUpdateArticle()">Agregar/Actualizar Artículo</button>
    <button onclick="clearArticleFields()">Limpiar Campos</button>

    <!-- Tabla de Artículos -->
    <table>
      <thead>
        <tr>
          <th>ID</th>
          <th>Marca</th>
          <th>Modelo</th>
          <th>Precio Compra</th>
          <th>Precio Venta</th>
          <th>Acciones</th>
        </tr>
      </thead>
      <tbody id="articleTable">
        <!-- Las filas se cargarán dinámicamente -->
      </tbody>
    </table>
  </div>

  <!-- Sección de IMEI -->
  <div class="container" id="imeiSection">
    <h2>Gestión de Existencias (IMEI)</h2>
    <!-- Selector para elegir un Artículo -->
    <select id="articleSelector">
      <option value="">Seleccione un Artículo</option>
      <!-- Opciones cargadas dinámicamente -->
    </select>
    <!-- Formulario para agregar IMEI -->
    <input type="text" id="imei" placeholder="IMEI" />
    <button onclick="addIMEI()">Agregar IMEI</button>

    <!-- Tabla de IMEIs -->
    <table>
      <thead>
        <tr>
          <th>ID (Registro)</th>
          <th>IMEI</th>
          <th>Acciones</th>
        </tr>
      </thead>
      <tbody id="imeiTable">
        <!-- Las filas se cargarán dinámicamente -->
      </tbody>
    </table>
  </div>

  <script>
    // Inicializar Firestore
    const db = firebase.firestore();

    /* =============================
       Funciones para Artículos
       ============================= */
    function clearArticleFields() {
      document.getElementById('articleId').value = '';
      document.getElementById('marca').value = '';
      document.getElementById('modelo').value = '';
      document.getElementById('precioCompra').value = '';
      document.getElementById('precioVenta').value = '';
    }

    function addOrUpdateArticle() {
      const id = document.getElementById('articleId').value.trim();
      const marca = document.getElementById('marca').value.trim();
      const modelo = document.getElementById('modelo').value.trim();
      const precioCompra = parseFloat(document.getElementById('precioCompra').value);
      const precioVenta = parseFloat(document.getElementById('precioVenta').value);

      if (!id) {
        alert("El ID del artículo es requerido 😅");
        return;
      }
      if (!marca || !modelo || isNaN(precioCompra) || isNaN(precioVenta)) {
        alert("Por favor, complete todos los campos correctamente 😬");
        return;
      }

      // Guardar o actualizar el artículo en la colección "Articulos"
      db.collection("Articulos").doc(id).set({
        id,
        marca,
        modelo,
        precioCompra,
        precioVenta
      })
      .then(() => {
        alert("Artículo guardado con éxito 😎");
        loadArticles();
        clearArticleFields();
      })
      .catch((error) => {
        console.error("Error al guardar el artículo: ", error);
      });
    }

    function loadArticles() {
      db.collection("Articulos").get().then((querySnapshot) => {
        const articleTable = document.getElementById('articleTable');
        const articleSelector = document.getElementById('articleSelector');
        articleTable.innerHTML = '';
        articleSelector.innerHTML = '<option value="">Seleccione un Artículo</option>';

        querySnapshot.forEach((doc) => {
   

